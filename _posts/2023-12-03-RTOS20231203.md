---
layout: post
title: 'XiLinx SDK FreeRTOS学习记录（二）——UART与蓝牙收发中的BytesNum清零问题'
---
## 问题简介
上一篇中我们说到我们将接收到的字节数一并传回，然后只把这个字节数打印出来，这就涉及到一个接收字节数清零的问题，因为要将所有数据都放在一个数组中，因此必须要有一个变量来记录上次接收到第几个字节了，所以只能在字节接收完毕后才可以将其清零而且必须清零。在原来的方案中，字节数清零是放在`XUARTPS_EVENT_RECV_DATA`分支中来做的，并且是在发送数据到队列之前，但是若是要将字节数传回就需要在打印之后才清零，也就是说必须要在发送数据到队列之后才可以清零，这里就衍生了两种方法。

## 方法一
第一种方法是将字节数设置为一个全局变量，打印时就可以读取字节数来决定打印多少字节，然后在打印完成后将字节数清零。

## 方法二
第二种方法是将发送数组改为发送一个结构体，这个结构体中包含了数组和字节数，当接收函数从队列中接收到结构体之后就可以读取到字节数了，然后在中断服务函数中，发送数据到队列之后就可以将字节数清零了。注：这种方法还没有实测效果。